---
description: Documenta√ß√£o e assistente de arquivos XML5 ANBIMA e suporte t√©cnico especializado
alwaysApply: false
---

# üìä Expertise em Arquivos de Carteiras de Investimentos - Padr√£o XML5 ANBIMA

> **üéØ Objetivo**: Guia completo para expertise em arquivos de carteiras de investimentos no padr√£o XML5 da ANBIMA, baseado nos manuais oficiais e regras de preenchimento, com assistente especializado em valida√ß√£o e suporte t√©cnico para backoffice.

<!-- √öltima otimiza√ß√£o: 2024-05-21 -->
<!-- Vers√£o compacta e consolidada -->

## üö® **Fundamentos do Padr√£o XML5 ANBIMA**

### 1. Vis√£o Geral e Evolu√ß√£o

**SEMPRE entenda** que o XML5 ANBIMA √© baseado no padr√£o internacional ISO 20022 (`semt.003.001.04`) desenvolvido pelo F√≥rum de Servi√ßos Fiduci√°rios da ANBIMA para padronizar a troca de informa√ß√µes entre institui√ß√µes do mercado financeiro brasileiro.

**SEMPRE reconhe√ßa** a evolu√ß√£o para a **Vers√£o 5.0** (Setembro 2024), que adapta √† RCVM 175 com estrutura ISO 20022 completa, Business Application Header (BAH) e segrega√ß√£o por Classe/Subclasse.

**SEMPRE aplique** as regras espec√≠ficas do mercado brasileiro, que podem diferir do padr√£o ISO 20022 original.

## üèóÔ∏è **Estrutura e Organiza√ß√£o do Arquivo XML5**

### 2. Estrutura Hier√°rquica

**SEMPRE compreenda** que o arquivo XML5 possui estrutura hier√°rquica baseada no padr√£o ISO 20022:

1. **Business Application Header (BAH)**: Cabe√ßalho de aplica√ß√£o de neg√≥cios ISO 20022 (obrigat√≥rio).
2. **Pagina√ß√£o** `<Pgntn>` [1..1]: Informa√ß√µes de pagina√ß√£o do arquivo.
3. **Detalhes Gerais** `<StmtGnlDtls>` [1..1]: Informa√ß√µes gerais do arquivo.
4. **Prestadores**:
   - **Administrador** `<AcctOwnr>` [0..1]
   - **Gestor** `<AcctSvcr>` [0..1]
   - **Custodiante** `<SfkpgAcct>` [1..1] (Obrigat√≥rio)
5. **Detalhes da Carteira** `<BalForAcct>` [1..n]: Informa√ß√µes da classe/subclasse/carteira.
6. **Detalhes dos Ativos** `<SubAcctDtls>` [1..n]: Informa√ß√µes espec√≠ficas de cada ativo.

### 3. Business Application Header (BAH)

**SEMPRE implemente** o BAH conforme especifica√ß√£o, contendo os campos obrigat√≥rios 001-008: Informante, CNPJ, Destinat√°rio (ex: PREVIC), Pa√≠s (BR), Nome da Mensagem (`semt.003.001.04`), Servi√ßo (`Arquivo de Posi√ß√£o 5.0`) e ID de envio.

### 4. Tipos de Arquivo e Nomenclatura

**SEMPRE use** nomenclatura correta no formato `{TIPO}{IDENTIFICADOR}_{AAAAMMDD}_{AAAAMMDDHHMMSS}_{SUFIXO}.XML`:

- **"CL"** (Classe): CNPJ da classe (14 chars)
- **"SC"** (Subclasse): C√≥digo CVM (10 chars)
- **"FC"** (Classe sem subclasse): CNPJ da classe
- **"FD"** (Fundo n√£o adaptado): CNPJ do fundo
- **"CT"** (Carteira administrada): C√≥digo interno (m√°x 14 chars)

## üìã **Regras de Preenchimento**

### 5. Regras por Tipo de Fundo

**SEMPRE aplique** a estrutura correta:

- **Fundo de Classe √önica**: Cadastro do fundo casca (opcional) + Cadastro da classe + Ativos + Despesas.
- **Fundo Multi-Classe**: Arquivo separado para cada classe.
- **Classe com Subclasse**: Fundo casca + Classe + Ativos + Subclasses + Despesas das subclasses.
  - **‚ö†Ô∏è CR√çTICO**: Despesas da subclasse s√£o necess√°rias para calcular o PL da classe.
- **Carteira Administrada**: Cadastro √∫nico + Ativos + Despesas.

### 6. Campos Obrigat√≥rios e Valida√ß√£o

**SEMPRE valide** os grupos de campos cr√≠ticos:

#### 6.1 Detalhes Gerais (009-021)

**SEMPRE valide** os campos de controle e status do arquivo:

- **Opera√ß√£o (QryRef)**: `1`-enviada, `2`-reenviada (exige justificativa), `3`-cancelada manual, `4`-cancelada auto.
- **Justificativa (stmtId)**: Obrigat√≥ria se opera√ß√£o = `2`.
- **Frequ√™ncia (frqcy.cd)**: Fixo `ADHO`.
- **Tipo Atualiza√ß√£o (updTp.cd)**: Fixo `COMP` (obrigat√≥rio).
- **Tipo Informa√ß√£o (stmtBsis.cd)**: Fixo `TRAD` (obrigat√≥rio).
- **Indicadores**: Atividade, Auditoria (sempre `true` para fundos), Subconta cust√≥dia.

#### 6.2 Grupos de Campos Principais

- **Prestadores (020-029)**: CNPJ do Administrador, Gestor e Custodiante, com Emissor (`Receita Federal do Brasil`) e Tipo (`CNPJ`).
- **Identifica√ß√£o do Fundo (030-040)**: ISIN, CNPJ, C√≥digos Galgo/ANBIMA, Tipo de fundo e Nome.

#### 6.3 Valores Financeiros Detalhados (041-049)

**SEMPRE valide** os detalhes financeiros cr√≠ticos:

- **Indicador (shrtLngInd)**: `LONG` (comprado, impacto positivo) ou `SHORT` (vendido, impacto negativo). **CR√çTICO** para c√°lculo do PL.
- **Tipo Pre√ßo (pricDtls.tp.cd)**: Fixo `NAVL`.
- **Moeda (pricDtls.val.amt.ccy)**: Fixo `BRL`.
- **Tipo Valor (pricDtls.valTp.valTp)**: Fixo `PARV`.
- **Campos**: Qtde de cota, Valor da cota, Total dos ativos, Sinal (Positivo/Negativo).

#### 6.4 Quantidades e Patrim√¥nio (050-055)

- **Quantidades**: Unidades (`AWAS`), Cotas a receber (`PEND`), Cotas a resgatar (`PENR`), Valores financeiros (`DIRT`).
- **Patrim√¥nio na Moeda Base** `<AcctBaseCcyTtlAmts>` [1..1]: **OBRIGAT√ìRIO**.
  - Representa o PL total da Classe/Carteira ou Patrim√¥nio da Subclasse.
  - Campos: Moeda (`BRL`), Valor PL, Sinal (`True`/`False`).

## üí∞ **Ativos, Despesas e Provis√µes**

### 7. Tipos de Ativos Suportados

#### 7.1 Tabelas de Identifica√ß√£o ANBIMA

**SEMPRE valide** a tabela correta para o tipo de ativo:

- **N√≠vel 1 (Identifica√ß√£o do Produto)**: **OBRIGAT√ìRIO** para todos os ativos.
  - C√≥digos: `CASH` (Caixa), `GOVE` (T√≠tulos P√∫blicos), `CORP` (T√≠tulos Privados), `DEBE` (Deb√™ntures), `REPO` (Compromissadas), `OPTN` (Op√ß√µes), `EQUI` (A√ß√µes), `SHAR` (Cota de Fundo).
- **N√≠vel 2 (Identifica√ß√£o do Lastro)**: Derivativos (Futuro, Swap, Op√ß√µes).
  - Identifica o ativo objeto da opera√ß√£o.
- **N√≠vel 3 (Identifica√ß√£o da Negocia√ß√£o)**: Opera√ß√µes e Contratos.
  - C√≥digos: `REAM` (Compromissada Compra), `RERA` (Compromissada Venda).

#### 7.2 Tipos de Ativos Contemplados

**SEMPRE reconhe√ßa** os tipos suportados (Lista completa formalizada no Q&A 5.0):

- **Renda Fixa**: Caixa, T√≠tulos P√∫blicos/Privados, Compromissadas, Termo RF, Deb√™ntures.
- **Renda Vari√°vel**: A√ß√µes B3, Op√ß√µes, Termo A√ß√µes, Empr√©stimo de A√ß√µes e Ativos B3.
- **Derivativos**: Futuro, Swap, Op√ß√£o de Derivativo, Op√ß√£o de Moedas, Forward de Moedas.
- **Outros**: Im√≥vel, Cotas (Fundo/Offshore), Provis√µes, Participa√ß√µes, Direitos Credit√≥rios.

### 8. Despesas e Provis√µes (C√≥digos ISO 20022)

**SEMPRE identifique** corretamente:

- **Despesas Liquidadas**: `EXPN` (Total), `MANF` (Taxa Adm), `EQUL` (Performance), `CUST` (Cust√≥dia), `BRKF` (Corretagem), `TAXS` (Tributos), `OTHR` (Outras).
- **Provis√µes**: `PAYA` (A Pagar), `FUTU` (Opera√ß√µes a Liquidar).
- **Quantidades**: `AWAS` (Ativos Dispon√≠veis), `DIRT` (Valor Financeiro), `PEND` (Cotas a Receber), `PENR` (Cotas a Resgatar).

**SEMPRE use** c√≥digos detalhados (01-15) para despesas espec√≠ficas (Advogados, Auditoria, Taxas ANBIMA/CVM, etc.).

## ‚úÖ **Valida√ß√£o e C√°lculos**

### 9. Valida√ß√£o de C√°lculos Financeiros

#### 9.1 Impacto de Posi√ß√µes e Regras ISIN

**SEMPRE verifique** o impacto no PL:

- **LONG**: Posi√ß√£o comprada ‚Üí Impacto positivo (+)
- **SHORT**: Posi√ß√£o vendida ‚Üí Impacto negativo (-)

**SEMPRE valide** regras de ISIN e CNPJ Emissor:

- **Nacional (B3)**: ISIN obrigat√≥rio. Se n√£o existir, usar `BR0000000000`.
- **Estrangeiro**: ISIN se houver. Se n√£o existir, usar `XX0000000000`.

#### 9.2 F√≥rmulas de Patrim√¥nio L√≠quido (PL)

**SEMPRE valide** as f√≥rmulas conforme o tipo de fundo:

#### 9.2.1 Classe COM Subclasses

- **PL Classe** = Somat√≥rio dos ativos (Classe) + Receitas (Classe + Subclasse) - Despesas (Classe + Subclasse) - Cotas a Emitir (Subclasse) - Cotas a Resgatar (Subclasse).
- **Alternativa**: Somat√≥rio do produto (Valor Cota Subclasse √ó Quantidade Subclasse).
- **‚ö†Ô∏è CR√çTICO**: O valor da cota da CLASSE √© apenas gerencial. **NUNCA** use para calcular o PL quando houver subclasses.

#### 9.2.2 Classe SEM Subclasses

- **PL Classe** = Ativos + Receitas - Despesas - Cotas a Emitir - Cotas a Resgatar.
- **Alternativa**: Valor Cota Classe √ó Quantidade de Cotas.

#### 9.2.3 Valida√ß√£o de Consist√™ncia

**SEMPRE verifique**: Quantidade de cota (042/033), Valor da cota (045/037), Valor total dos ativos (048/040) e Sinal (049/041).

### 10. Valida√ß√£o Regulat√≥ria (PREVIC/ANBIMA)

#### 10.1 Valida√ß√£o XSD e Estrutura

**SEMPRE valide** contra os 3 schemas principais:

1. `head.001.001.01.xsd` (namespace `<p:>`) - Envio e tamanho.
2. `semt.003.001.04.xsd` (namespace `<ns3:>`) - Informa√ß√µes do fundo e ativos.
3. `SchemaBalanceForSubAccountBrazil.xsd` (namespace `<posatbr:>`) - Extens√µes Brasil.

#### 10.2 Validador ANBIMA

**SEMPRE considere** o n√≠vel de verifica√ß√£o:

- **Verifica**: Estrutura, tamanho dos campos, ISIN, coer√™ncia de somat√≥rios (Ativos vs PL).
- **N√ÉO Verifica**: Exist√™ncia real do ISIN ou validade externa do ativo (sem acesso externo).

**SEMPRE considere** campos inspecionados pelo PREVIC:

- **Obrigat√≥rios**: Prestadores (CNPJ), Identifica√ß√£o (ISIN, CNPJ), Valores (Cotas, PL), Despesas (Taxas, Corretagem, Tributos), Provis√µes.
- **Opcionais**: Informante, Destinat√°rio, C√≥digos Galgo/ANBIMA, Detalhes opcionais de despesas.

## üíª **Exemplos Pr√°ticos XML5**

### 11. Estrutura Simplificada de Arquivo

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Document xmlns="urn:iso:std:iso:20022:tech:xsd:semt.003.001.04">
  <!-- 1. Business Application Header -->
  <bsnsMsg>
    <appHdr>
      <fr><orgId><nm>Institui√ß√£o</nm><id><orgId><othr><id>12345678901234</id><schmeNm><cd>CNPJ</cd></schmeNm></othr></orgId></id></orgId></fr>
      <to><orgId><nm>PREVIC</nm><ctryOfRes>BR</ctryOfRes></orgId></to>
      <msgDefIdr>semt.003.001.04</msgDefIdr>
      <bizSvc>Arquivo de Posi√ß√£o 5.0</bizSvc>
    </appHdr>
  </bsnsMsg>

  <!-- 2. Relat√≥rio -->
  <rpt>
    <id>RPT001</id>
    <rptPgntn><pgNb>1</pgNb><lastPgInd>true</lastPgInd></rptPgntn>

    <!-- 3. Informa√ß√µes do Fundo -->
    <fndInf>
      <fndId>12345678901234</fndId>
      <fndNm>Fundo Exemplo</fndNm>
      <fndTp>FIC</fndTp>
      <fndClss>
        <id>CLS001</id>
        <nm>Classe A</nm>
        <qty>1000.00</qty>
        <valtn><amt ccy="BRL">1000000.00</amt></valtn>
        <!-- Despesas -->
        <fees>
           <admFee>0.0125</admFee>
           <perfFee>0.20</perfFee>
        </fees>
      </fndClss>
    </fndInf>

    <!-- 4. Posi√ß√µes -->
    <pos>
      <id>POS001</id>
      <qty><unit>100.00</unit><ccy>BRL</ccy></qty>
      <valtn><amt ccy="BRL">50000.00</amt><pctg>0.05</pctg></valtn>
      <finInstrmId>
        <id>BRSTNCLTN7</id><idTp>ISIN</idTp>
      </finInstrmId>
      <finInstrmAttrbts>
        <nm>Tesouro Selic 2029</nm>
        <clssfctnTp>BOND</clssfctnTp>
        <mtrtyDt>2029-01-01</mtrtyDt>
      </finInstrmAttrbts>
    </pos>
  </rpt>
</Document>
```

## üõ†Ô∏è **Ferramentas, Suporte e Valida√ß√£o**

### 12. An√°lise e Suporte T√©cnico

**SEMPRE realize** an√°lise completa baseada em:

1. Estrutura XML5 e regras ANBIMA.
2. Valida√ß√£o de c√≥digos (ISIN, CNPJ) e formatos.
3. Consist√™ncia de c√°lculos (PL, Cotas).

**SEMPRE estruture** respostas de suporte com:

- **Problema**: Descri√ß√£o clara da inconsist√™ncia.
- **Localiza√ß√£o**: Caminho XML (`<Tag>`) onde ocorre o erro.
- **Solu√ß√£o**: Instru√ß√£o acion√°vel para corre√ß√£o.

### 13. Checklist de Valida√ß√£o

**SEMPRE verifique** antes da entrega:

- [ ] **Estrutura XML**: V√°lida, UTF-8, Namespace correto, BAH presente.
- [ ] **Nomenclatura**: Formato correto conforme tipo (CL, SC, FC, etc.).
- [ ] **Campos Obrigat√≥rios**: Prestadores, Identifica√ß√£o Fundo, Valores.
- [ ] **C√≥digos**: CNPJ (14 d√≠gitos), ISIN (BR+10 alphanum), CVM, ANBIMA v√°lidos.
- [ ] **C√°lculos**: PL consiste com ativos/passivos? Valor Cota x Qtde bate?
- [ ] **Neg√≥cio**: Segrega√ß√£o Classe/Subclasse correta? Despesas informadas?
- [ ] **Conformidade**: Atende regras PREVIC/ANBIMA?

## üìö **Refer√™ncias**

### 14. Documenta√ß√£o Oficial

- **Manual de Preenchimento XML 5.0**: Adapta√ß√£o √† RCVM 175.
- **Regras de Preenchimento**: CSV oficial com campos e valida√ß√µes.
- **RCVM 175**: Instru√ß√£o CVM base para a nova estrutura.
- **ISO 20022**: Padr√£o internacional (msg `semt.003.001.04`).
