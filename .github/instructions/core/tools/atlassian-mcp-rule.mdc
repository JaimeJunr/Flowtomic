---
description: Diretrizes completas para uso das ferramentas MCP do Atlassian (Confluence e Jira) - buscar ticket no jira
alwaysApply: false
---

# Atlassian MCP Tools - Integra√ß√£o com Confluence e Jira

> **üéØ Objetivo**: Fornecer diretrizes completas para uso das ferramentas MCP do Atlassian (Confluence e Jira) no projeto PerformIt Rails, baseado na documenta√ß√£o oficial do [mcp-atlassian](https://github.com/sooperset/mcp-atlassian/tree/v0.11.2).

## 1. Comportamento Obrigat√≥rio

**SEMPRE execute** estas a√ß√µes ao usar as ferramentas:

1. **SEMPRE use** ferramentas de leitura antes de opera√ß√µes de escrita
2. **SEMPRE valide** par√¢metros obrigat√≥rios antes de chamar ferramentas
3. **SEMPRE trate** erros de autentica√ß√£o e permiss√£o adequadamente
4. **SEMPRE use** projeto **CAP** para tickets da InvestTools
5. **SEMPRE respeite** rate limiting (300 requests/minuto no Cloud)

## 2. Ferramentas Jira

### 2.1 Busca de Issues

**SEMPRE use** `jira_search` com JQL para buscar issues:

```ruby
# ‚úÖ CORRETO: Buscar issues do projeto CAP
jira_search(jql: "project = CAP ORDER BY updated DESC")

# ‚úÖ CORRETO: Buscar por status
jira_search(jql: "project = CAP AND status = '2. Doing'")

# ‚úÖ CORRETO: Buscar por tipo
jira_search(jql: "issuetype = 'Hist√≥ria' AND project = CAP")

# ‚úÖ CORRETO: Buscar atribu√≠das ao usu√°rio
jira_search(jql: "project = CAP AND assignee = currentUser()")

# ‚úÖ CORRETO: Buscar recentes
jira_search(jql: "project = CAP AND updated >= -7d ORDER BY updated DESC")
```

**SEMPRE use** `jira_get_issue` para detalhes completos:

```ruby
# ‚úÖ CORRETO: Buscar issue espec√≠fico
jira_get_issue(issue_key: "CAP-123")

# ‚úÖ CORRETO: Com campos espec√≠ficos
jira_get_issue(issue_key: "CAP-123", fields: "summary,status,assignee,priority")

# ‚úÖ CORRETO: Com coment√°rios
jira_get_issue(issue_key: "CAP-123", comment_limit: 20)
```

**SEMPRE use** `jira_get_board_issues` para board espec√≠fico:

```ruby
# Board Principal do projeto CAP √© ID 46
jira_get_board_issues(
  board_id: "46",
  jql: "ORDER BY updated DESC",
  limit: 20
)
```

### 2.2 Projeto CAP - InvestTools

**SEMPRE use** estas informa√ß√µes do projeto CAP:

- **Projeto Key**: `CAP`
- **Board Principal**: "Board DM - Controladoria" (ID: 46)
- **Tipos**: `Hist√≥ria`, `Tarefa`, `Bug`, `An√°lise`
- **Status**: `1. TO DO`, `2. Doing`, `5. N1 TEST`, `Waiting deploy`, `Conclu√≠do`
- **Prioridades**: `Highest`, `Medium`

### 2.3 Tipos de Tickets

**SEMPRE identifique** o tipo correto antes de criar ou buscar:

- **`Hist√≥ria`** - Funcionalidades expressadas como objetivo do usu√°rio
- **`Tarefa`** - Trabalho t√©cnico ou administrativo distinto
- **`Bug`** - Problema ou erro no sistema
- **`An√°lise`** - Investiga√ß√£o e an√°lise de problemas

**Padr√µes JQL por tipo:**

```sql
-- Hist√≥rias em desenvolvimento
issuetype = "Hist√≥ria" AND project = CAP AND status = "2. Doing"

-- Tarefas atribu√≠das ao usu√°rio
issuetype = "Tarefa" AND project = CAP AND assignee = currentUser()

-- Bugs de alta prioridade
issuetype = "Bug" AND project = CAP AND priority = Highest

-- An√°lises pendentes
issuetype = "An√°lise" AND project = CAP AND status != "Conclu√≠do"
```

**Exemplos de cria√ß√£o por tipo:**

```ruby
# ‚úÖ CORRETO: Hist√≥ria
jira_create_issue(
  project_key: "CAP",
  summary: "Inclus√£o da op√ß√£o selecionar 'todos os fundos' no relat√≥rio de liquidez FOF",
  issue_type: "Hist√≥ria",
  description: "Como usu√°rio do PIT, eu quero uma forma f√°cil e eficiente de selecionar m√∫ltiplos fundos..."
)

# ‚úÖ CORRETO: Bug
jira_create_issue(
  project_key: "CAP",
  summary: "Sistema tratando incorretamente o fator de convers√£o das op√ß√µes de IBOV",
  issue_type: "Bug",
  description: "O sistema est√° tratando incorretamente o pre√ßo das op√ß√µes..."
)

# ‚úÖ CORRETO: An√°lise
jira_create_issue(
  project_key: "CAP",
  summary: "Analisar o que est√° causando problema no LMS da Oceana",
  issue_type: "An√°lise",
  description: "A Isabella da Oceana comentou sobre um problema que est√° enfrentando no LMS..."
)
```

### 2.4 Status e Workflow

**SEMPRE use** estes status do workflow InvestTools:

- **`1. TO DO`** - Pendentes, planejados mas n√£o iniciados
- **`2. Doing`** - Em andamento, desenvolvimento ativo
- **`5. N1 TEST`** - Em teste N1 (primeiro n√≠vel de teste)
- **`Waiting deploy`** - Conclu√≠dos, aguardando deploy
- **`Conclu√≠do`** - Conclu√≠dos e entregues

**Fluxo de status:**

```mermaid
flowchart LR
    TODO[1. TO DO] --> DOING[2. Doing]
    DOING --> TEST[5. N1 TEST]
    TEST --> DOING
    TEST --> DEPLOY[Waiting deploy]
    DEPLOY --> DONE[Conclu√≠do]
```

**Padr√µes JQL por status:**

```sql
-- Tarefas para trabalhar hoje
status = '1. TO DO' AND project = CAP AND assignee = currentUser() ORDER BY priority DESC

-- Tarefas em progresso
status = '2. Doing' AND project = CAP AND assignee = currentUser()

-- Tarefas em teste
status = '5. N1 TEST' AND project = CAP ORDER BY updated DESC

-- Aguardando deploy
status = 'Waiting deploy' AND project = CAP ORDER BY updated ASC

-- Conclu√≠das recentemente
status = 'Conclu√≠do' AND project = CAP AND updated >= -7d ORDER BY updated DESC
```

**SEMPRE use** `jira_transition_issue` para transi√ß√µes:

```ruby
# ‚úÖ CORRETO: Iniciar trabalho (1. TO DO ‚Üí 2. Doing)
jira_transition_issue(
  issue_key: "CAP-123",
  transition_id: "11",
  comment: "Iniciando desenvolvimento da funcionalidade"
)

# ‚úÖ CORRETO: Enviar para teste (2. Doing ‚Üí 5. N1 TEST)
jira_transition_issue(
  issue_key: "CAP-123",
  transition_id: "21",
  comment: "C√≥digo pronto para teste N1. PR #456 criado."
)

# ‚úÖ CORRETO: Aprovar teste (5. N1 TEST ‚Üí Waiting deploy)
jira_transition_issue(
  issue_key: "CAP-123",
  transition_id: "31",
  comment: "Teste N1 aprovado. Enviando para deploy."
)

# ‚úÖ CORRETO: Concluir (Waiting deploy ‚Üí Conclu√≠do)
jira_transition_issue(
  issue_key: "CAP-123",
  transition_id: "41",
  comment: "Deploy conclu√≠do com sucesso. Tarefa finalizada."
)
```

### 2.5 Prioridades e Labels

**SEMPRE use** prioridades e labels para organiza√ß√£o:

**Prioridades:**

- **`Highest`** - Cr√≠tico: Sistema inoperante, produ√ß√£o afetada
- **`Medium`** - M√©dio: Funcionalidade secund√°ria afetada (mais comum)

**Labels comuns:**

- `frontend`, `backend`, `database`, `infrastructure`
- `security`, `performance`, `bug`, `feature`
- `refactor`, `documentation`, `urgent`, `blocked`

**Padr√µes JQL por prioridade e label:**

```sql
-- Tickets cr√≠ticos
priority = Highest AND project = CAP ORDER BY updated DESC

-- Bugs de alta prioridade
issuetype = Bug AND priority = Highest AND project = CAP

-- Tickets frontend em progresso
labels = frontend AND status = '2. Doing' AND project = CAP

-- Tickets urgentes
labels = urgent AND project = CAP ORDER BY priority DESC
```

**SEMPRE inclua** prioridade e labels ao criar issues:

```ruby
# ‚úÖ CORRETO: Bug cr√≠tico
jira_create_issue(
  project_key: "CAP",
  summary: "Sistema tratando incorretamente o fator de convers√£o das op√ß√µes de IBOV",
  issue_type: "Bug",
  additional_fields: {
    'priority' => {'name' => 'Highest'},
    'labels' => ['bug', 'urgent', 'backend']
  }
)
```

### 2.6 Opera√ß√µes de Escrita

**SEMPRE use** `jira_create_issue` para criar issues:

```ruby
# ‚úÖ CORRETO: Issue b√°sico
jira_create_issue(
  project_key: "CAP",
  summary: "Implementar nova funcionalidade",
  issue_type: "Tarefa",
  description: "Descri√ß√£o detalhada da tarefa"
)

# ‚úÖ CORRETO: Com campos adicionais
jira_create_issue(
  project_key: "CAP",
  summary: "Bug cr√≠tico no sistema",
  issue_type: "Bug",
  assignee: "user@example.com",
  components: "Frontend,API",
  additional_fields: {
    'priority' => {'name' => 'Highest'},
    'labels' => ['urgent', 'frontend']
  }
)
```

**SEMPRE use** `jira_update_issue` para atualiza√ß√µes:

```ruby
# ‚úÖ CORRETO: Atualiza√ß√£o b√°sica
jira_update_issue(
  issue_key: "CAP-123",
  fields: {
    'summary' => 'Novo t√≠tulo da issue',
    'assignee' => 'newuser@example.com'
  }
)

# ‚úÖ CORRETO: Atualizar prioridade e labels
jira_update_issue(
  issue_key: "CAP-123",
  fields: {
    'priority' => {'name' => 'Highest'}
  },
  additional_fields: {
    'labels' => ['bug', 'critical', 'blocked']
  }
)
```

**SEMPRE use** `jira_add_comment` e `jira_add_worklog`:

```ruby
# ‚úÖ CORRETO: Adicionar coment√°rio
jira_add_comment(
  issue_key: "CAP-123",
  comment: "Coment√°rio em Markdown com **formata√ß√£o**"
)

# ‚úÖ CORRETO: Adicionar worklog
jira_add_worklog(
  issue_key: "CAP-123",
  time_spent: "2h 30m",
  comment: "Trabalho realizado na implementa√ß√£o"
)
```

## 3. Ferramentas Confluence

### 3.1 Busca e Leitura

**SEMPRE use** `confluence_search` para buscar conte√∫do:

```ruby
# ‚úÖ CORRETO: Busca simples
confluence_search(query: "documenta√ß√£o do projeto")

# ‚úÖ CORRETO: Busca com CQL
confluence_search(query: "type=page AND space=DEV AND title~\"API\"")
confluence_search(query: "created >= \"2024-01-01\" AND space=TEAM")
```

**SEMPRE use** `confluence_get_page` para obter p√°ginas:

```ruby
# ‚úÖ CORRETO: Por ID
confluence_get_page(page_id: "123456789")

# ‚úÖ CORRETO: Por t√≠tulo e espa√ßo
confluence_get_page(
  title: "Documenta√ß√£o da API",
  space_key: "DEV"
)

# ‚úÖ CORRETO: Com metadados e convers√£o Markdown
confluence_get_page(
  page_id: "123456789",
  include_metadata: true,
  convert_to_markdown: true
)

# ‚úÖ CORRETO: P√°ginas filhas
confluence_get_page_children(
  parent_id: "123456789",
  include_content: true,
  limit: 25
)
```

### 3.2 Cria√ß√£o e Atualiza√ß√£o

**SEMPRE use** `confluence_create_page` com conte√∫do Markdown:

```ruby
# ‚úÖ CORRETO: P√°gina b√°sica
confluence_create_page(
  space_key: "DEV",
  title: "Nova Documenta√ß√£o",
  content: "# T√≠tulo\n\nConte√∫do em **Markdown**"
)

# ‚úÖ CORRETO: P√°gina com pai
confluence_create_page(
  space_key: "DEV",
  title: "Subp√°gina",
  content: "Conte√∫do da subp√°gina",
  parent_id: "123456789"
)
```

**SEMPRE use** `confluence_update_page` para modifica√ß√µes:

```ruby
# ‚úÖ CORRETO: Atualiza√ß√£o b√°sica
confluence_update_page(
  page_id: "123456789",
  title: "T√≠tulo Atualizado",
  content: "# Novo Conte√∫do\n\nAtualiza√ß√£o em **Markdown**"
)

# ‚úÖ CORRETO: Com coment√°rio de vers√£o
confluence_update_page(
  page_id: "123456789",
  title: "T√≠tulo Atualizado",
  content: "Conte√∫do atualizado",
  version_comment: "Corre√ß√£o de informa√ß√µes"
)
```

## 4. Padr√µes de Busca (JQL e CQL)

### 4.1 Padr√µes JQL Comuns

**SEMPRE use** estes padr√µes JQL para buscas eficientes:

```sql
-- Issues por status
status = '2. Doing' AND project = CAP

-- Issues atribu√≠dos ao usu√°rio atual
assignee = currentUser()

-- Issues recentemente atualizados
updated >= -7d AND project = CAP

-- Issues por tipo
issuetype = 'Hist√≥ria' AND project = CAP

-- Issues por prioridade
priority = Highest AND project = CAP

-- Issues por label
labels = frontend AND project = CAP

-- Issues com texto espec√≠fico
text ~ "bug" AND project = CAP

-- Issues em sprint espec√≠fico (se aplic√°vel)
sprint = 10001 AND project = CAP
```

### 4.2 Padr√µes CQL Comuns

**SEMPRE use** estes padr√µes CQL para buscas eficientes:

```sql
-- P√°ginas por tipo
type = page AND space = DEV

-- P√°ginas por t√≠tulo
title ~ "API Documentation"

-- P√°ginas recentes
created >= "2024-01-01"

-- P√°ginas por autor
creator = currentUser()

-- P√°ginas com label espec√≠fico
label = documentation

-- P√°ginas modificadas recentemente
lastModified > startOfMonth("-1M")
```

## 5. Limita√ß√µes e Considera√ß√µes

**SEMPRE considere** estas limita√ß√µes ao usar as ferramentas:

- **Rate Limiting**: Atlassian Cloud tem limite de 300 requests/minuto
- **Tamanho de Conte√∫do**: Confluence limita p√°ginas a 25MB
- **Campos Customizados**: Jira requer conhecimento de IDs de campos
- **Permiss√µes**: Usu√°rio deve ter acesso aos projetos/espa√ßos necess√°rios
- **Erros de Autentica√ß√£o**: Verifique tokens e configura√ß√µes se ocorrer erro 401/403

**SEMPRE trate** erros adequadamente:

- **401 Unauthorized**: Problema de autentica√ß√£o - verifique tokens
- **403 Forbidden**: Falta de permiss√£o - verifique acesso ao projeto/espa√ßo
- **404 Not Found**: Recurso n√£o encontrado - verifique IDs/chaves fornecidas
- **429 Too Many Requests**: Rate limit excedido - aguarde antes de novas requisi√ß√µes

## 6. Exemplos Pr√°ticos para PerformIt

### 6.1 Buscar Ticket do Jira

**SEMPRE use** este padr√£o para buscar tickets:

```ruby
# ‚úÖ CORRETO: Buscar ticket espec√≠fico
jira_get_issue(issue_key: "CAP-123")

# ‚úÖ CORRETO: Buscar tickets recentes do projeto
jira_search(jql: "project = CAP AND updated >= -7d ORDER BY updated DESC LIMIT 20")

# ‚úÖ CORRETO: Buscar tickets atribu√≠dos ao usu√°rio
jira_search(jql: "project = CAP AND assignee = currentUser() AND status != 'Conclu√≠do'")
```

### 6.2 Criar Issue para Bug

**SEMPRE use** este padr√£o para criar bugs:

```ruby
# ‚úÖ CORRETO: Criar issue de bug
jira_create_issue(
  project_key: "CAP",
  summary: "Bug: Erro na convers√£o de moeda USD-BRL",
  issue_type: "Bug",
  description: "**Descri√ß√£o:**\n\nErro na convers√£o de moeda USD para BRL no sistema de pricing.\n\n**Passos para reproduzir:**\n1. Acessar tela de pricing\n2. Selecionar moeda USD\n3. Observar erro de convers√£o\n\n**Comportamento esperado:**\nConvers√£o deve funcionar normalmente",
  additional_fields: {
    'priority' => {'name' => 'Highest'},
    'labels' => ['pricing', 'currency', 'bug']
  }
)
```

### 6.3 Atualizar Status de Issue

**SEMPRE atualize** status com coment√°rios informativos:

```ruby
# ‚úÖ CORRETO: Atualizar status para "In Progress"
jira_transition_issue(
  issue_key: "CAP-123",
  transition_id: "11",
  comment: "Iniciando investiga√ß√£o do problema de convers√£o de moeda"
)
```

### 6.4 Criar Documenta√ß√£o no Confluence

**SEMPRE use** este padr√£o para documenta√ß√£o:

```ruby
# ‚úÖ CORRETO: Criar p√°gina de documenta√ß√£o
confluence_create_page(
  space_key: "DEV",
  title: "API PerformIt - Endpoints de Pricing",
  content: "# API PerformIt - Pricing\n\n## Endpoints\n\n### GET /api/pricing\n\nRetorna informa√ß√µes de pricing...",
  parent_id: "parent_page_id"
)
```

## 7. Refer√™ncias

### Documenta√ß√£o Oficial

- [mcp-atlassian GitHub](https://github.com/sooperset/mcp-atlassian/tree/v0.11.2)
- [Jira REST API](https://developer.atlassian.com/cloud/jira/platform/rest/v2/)
- [Confluence REST API](https://developer.atlassian.com/cloud/confluence/rest/v2/)

### Recursos de Ajuda

- [JQL Syntax](https://www.atlassian.com/software/jira/guides/expand-jira/jql)
- [CQL Syntax](https://developer.atlassian.com/cloud/confluence/advanced-searching-using-cql/)

**Por que estas regras existem**: Integra√ß√£o eficiente com Atlassian garante documenta√ß√£o e gest√£o de projetos centralizadas
