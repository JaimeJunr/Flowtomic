---
description: Padr√µes e melhores pr√°ticas para testes Jest em projetos JavaScript/TypeScript, aplicando TDD e garantindo qualidade e cobertura de c√≥digo
globs: **/*.test.js,**/*.test.jsx,**/*.test.ts,**/*.test.tsx,**/*.spec.js,**/*.spec.jsx,**/*.spec.ts,**/*.spec.tsx
alwaysApply: false
---

# üß™ Padr√µes de Testes Jest

> **üìö TDD First**: Esta regra define padr√µes obrigat√≥rios para testes Jest, garantindo qualidade, cobertura e manutenibilidade seguindo princ√≠pios de Test-Driven Development.

## üö® **COMPORTAMENTO OBRIGAT√ìRIO**

### **A√ß√µes Cr√≠ticas**

1. **SEMPRE escreva testes PRIMEIRO** antes de implementar funcionalidades (TDD)
2. **SEMPRE mantenha cobertura m√≠nima** de 70% conforme configurado no projeto
3. **SEMPRE use padr√£o AAA** (Arrange-Act-Assert) em todos os testes
4. **SEMPRE nomeie testes** de forma descritiva e espec√≠fica
5. **SEMPRE teste casos de borda** e tratamento de erros
6. **SEMPRE mantenha testes independentes** e isolados

## üèóÔ∏è **ESTRUTURA E ORGANIZA√á√ÉO**

### **1. Estrutura de Arquivos de Teste**

**SEMPRE siga** a estrutura do projeto:

```text
src/
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ components/          # Testes de componentes
‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Testes de utilit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ services/           # Testes de servi√ßos
‚îÇ   ‚îî‚îÄ‚îÄ hooks/              # Testes de hooks (se aplic√°vel)
```

**SEMPRE nomeie** arquivos com sufixo `.test.{js,jsx,ts,tsx}` ou `.spec.{js,jsx,ts,tsx}`

### **2. Organiza√ß√£o de Testes**

**SEMPRE use** blocos `describe` para agrupar testes relacionados:

```javascript
// ‚úÖ CORRETO
describe("Validation Utils", () => {
  describe("validateId", () => {
    it("should validate normal IDs correctly", () => {
      // teste
    });
  });
});

// ‚ùå INCORRETO
it("should validate normal IDs correctly", () => {
  // teste isolado sem contexto
});
```

## üìù **PADR√ÉO AAA OBRIGAT√ìRIO**

### **1. Arrange (Preparar)**

**SEMPRE prepare** dados e ambiente antes do teste:

```javascript
// ‚úÖ CORRETO
it("should detect timestamp-like IDs", () => {
  // Arrange
  const timestampId = 1755645845907;

  // Act
  const result = validateId(timestampId);

  // Assert
  expect(result.isValid).toBe(false);
  expect(result.isTimestamp).toBe(true);
});
```

### **2. Act (Executar)**

**SEMPRE execute** apenas a fun√ß√£o/m√©todo sendo testado:

```javascript
// ‚úÖ CORRETO
const result = validateId(timestampId);

// ‚ùå INCORRETO
const result = validateId(timestampId);
const processed = processResult(result);
const final = formatOutput(processed);
```

### **3. Assert (Verificar)**

**SEMPRE verifique** resultados espec√≠ficos e m√∫ltiplos aspectos:

```javascript
// ‚úÖ CORRETO
expect(result.isValid).toBe(false);
expect(result.issues).toContain("ID parece ser um timestamp");
expect(result.isTimestamp).toBe(true);

// ‚ùå INCORRETO
expect(result).toBeDefined();
```

## üéØ **NOMEA√á√ÉO E DESCRI√á√ÉO**

### **1. Nomes de Testes**

**SEMPRE use** nomes descritivos que explicam o comportamento:

```javascript
// ‚úÖ CORRETO
it("should detect timestamp-like IDs", () => {});
it("should return error when password is too short", () => {});
it("should handle empty array gracefully", () => {});

// ‚ùå INCORRETO
it("test 1", () => {});
it("works", () => {});
it("should work", () => {});
```

### **2. Descri√ß√µes de Grupos**

**SEMPRE agrupe** testes logicamente por funcionalidade:

```javascript
// ‚úÖ CORRETO
describe("Validation Utils", () => {
  describe("validateId", () => {
    // testes espec√≠ficos para validateId
  });

  describe("timestampToDate", () => {
    // testes espec√≠ficos para timestampToDate
  });
});
```

## üß™ **TIPOS DE TESTES OBRIGAT√ìRIOS**

### **1. Testes de Funcionalidade Normal**

**SEMPRE teste** o comportamento esperado com dados v√°lidos:

```javascript
it("should validate normal IDs correctly", () => {
  const result = validateId(4);
  expect(result.isValid).toBe(true);
  expect(result.issues).toHaveLength(0);
});
```

### **2. Testes de Casos de Borda**

**SEMPRE teste** valores extremos e limites:

```javascript
it("should detect overflow IDs", () => {
  const result = validateId(2147483648);
  expect(result.isValid).toBe(false);
  expect(result.isOverflow).toBe(true);
});

it("should detect negative IDs", () => {
  const result = validateId(-1);
  expect(result.isValid).toBe(false);
});
```

### **3. Testes de Tratamento de Erros**

**SEMPRE teste** como o c√≥digo lida com entradas inv√°lidas:

```javascript
it("should handle invalid timestamp gracefully", () => {
  const result = timestampToDate(NaN);
  expect(result).toBe("Data inv√°lida");
});
```

## üîß **MOCKS E SPIES**

### **1. Uso de Mocks**

**SEMPRE use** mocks para depend√™ncias externas:

```javascript
// ‚úÖ CORRETO
const consoleSpy = jest.spyOn(console, "log").mockImplementation();

logValidation(1755645845907, "test");

expect(consoleSpy).toHaveBeenCalledWith(
  "üîç VALIDATION [test]:",
  expect.objectContaining({
    id: 1755645845907,
  })
);

consoleSpy.mockRestore();
```

### **2. Limpeza de Mocks**

**SEMPRE restaure** mocks ap√≥s cada teste:

```javascript
// ‚úÖ CORRETO
afterEach(() => {
  jest.clearAllMocks();
  jest.restoreAllMocks();
});
```

## üìä **COBERTURA E QUALIDADE**

### **1. Cobertura M√≠nima**

**SEMPRE mantenha** cobertura conforme configurado no projeto:

```javascript
// jest.config.js - Cobertura m√≠nima recomendada
coverageThreshold: {
  global: {
    branches: 70,
    functions: 70,
    lines: 70,
    statements: 70,
  },
}
```

### **2. Verifica√ß√£o de Qualidade**

**SEMPRE execute** testes antes de concluir:

```bash
# Comandos obrigat√≥rios (ajuste conforme seu projeto)
npm test              # Execu√ß√£o completa
npm run test:watch    # Modo watch para desenvolvimento
npm run test:coverage # Relat√≥rio de cobertura

# Alternativas para outros gerenciadores de pacotes
yarn test
pnpm test
```

## üö´ **PROIBI√á√ïES ABSOLUTAS**

### **1. Testes Dependentes**

**NUNCA crie** testes que dependem de outros:

```javascript
// ‚ùå INCORRETO
let counter = 0;

it("should increment counter", () => {
  counter++;
  expect(counter).toBe(1);
});

it("should continue incrementing", () => {
  counter++;
  expect(counter).toBe(2); // ‚ùå Depende do teste anterior
});
```

### **2. Testes de Implementa√ß√£o**

**NUNCA teste** m√©todos privados ou detalhes internos:

```javascript
// ‚ùå INCORRETO
it("should call internal method", () => {
  const spy = jest.spyOn(instance, "privateMethod");
  instance.publicMethod();
  expect(spy).toHaveBeenCalled(); // ‚ùå Testa implementa√ß√£o
});

// ‚úÖ CORRETO
it("should return expected result", () => {
  const result = instance.publicMethod();
  expect(result).toBe(expectedValue); // ‚úÖ Testa comportamento
});
```

### **3. Testes Lentos**

**NUNCA crie** testes que dependem de opera√ß√µes lentas:

```javascript
// ‚ùå INCORRETO
it("should fetch data from API", async () => {
  const data = await fetch("https://api.external.com/data");
  expect(data).toBeDefined(); // ‚ùå Depend√™ncia externa lenta
});
```

## üîÑ **FLUXO TDD OBRIGAT√ìRIO**

### **1. Ciclo TDD**

**SEMPRE siga** o fluxo Red-Green-Refactor:

```text
1. Red: Escrever teste que falha
2. Green: Implementar c√≥digo m√≠nimo para passar
3. Refactor: Melhorar c√≥digo mantendo testes passando
```

### **2. Implementa√ß√£o Gradual**

**SEMPRE implemente** funcionalidades incrementalmente:

```javascript
// ‚úÖ CORRETO - Implementa√ß√£o gradual
describe("User Authentication", () => {
  it("should validate email format", () => {
    // Primeiro teste - valida√ß√£o b√°sica
  });

  it("should validate password strength", () => {
    // Segundo teste - valida√ß√£o de senha
  });

  it("should authenticate valid credentials", () => {
    // Terceiro teste - autentica√ß√£o completa
  });
});
```

## üìã **CHECKLIST DE QUALIDADE**

### **Antes de Concluir Testes**

- [ ] Testes seguem padr√£o AAA (Arrange-Act-Assert)
- [ ] Nomes s√£o descritivos e espec√≠ficos
- [ ] Casos de borda est√£o cobertos
- [ ] Tratamento de erros est√° testado
- [ ] Mocks s√£o usados para depend√™ncias externas
- [ ] Testes s√£o independentes e isolados
- [ ] Cobertura m√≠nima de 70% √© mantida
- [ ] Todos os testes passam (comando de teste do projeto)

### **Verifica√ß√£o de Estrutura**

- [ ] Arquivos organizados em pastas apropriadas
- [ ] Grupos `describe` organizam testes logicamente
- [ ] Testes individuais s√£o focados e espec√≠ficos
- [ ] Setup e teardown s√£o usados quando necess√°rio

## üîó **INTEGRA√á√ÉO COM PROJETO**

### **1. Configura√ß√£o Jest**

**SEMPRE use** configura√ß√£o existente do projeto:

```javascript
// jest.config.js - Configura√ß√£o padr√£o
module.exports = {
  setupFilesAfterEnv: ["<rootDir>/jest.setup.js"],
  testEnvironment: "jsdom", // ou 'node' para testes de backend
  moduleNameMapper: {
    "^@/(.*)$": "<rootDir>/src/$1",
  },
  // Outras configura√ß√µes espec√≠ficas do projeto
};
```

### **2. Ambiente de Testes**

**SEMPRE configure** ambiente apropriado para seu projeto:

```javascript
// jest.setup.js - Configura√ß√µes globais
import "@testing-library/jest-dom"; // Para testes de componentes React
// Outras configura√ß√µes globais conforme necess√°rio
```

### **3. Comandos de Execu√ß√£o**

**SEMPRE use** scripts configurados no projeto:

```bash
# Ajuste conforme seu gerenciador de pacotes
npm test              # Execu√ß√£o completa
npm run test:watch    # Desenvolvimento iterativo
npm run test:coverage # An√°lise de cobertura

# Alternativas
yarn test
pnpm test
```

## üìö **EXEMPLOS DE IMPLEMENTA√á√ÉO**

### **1. Teste de Utilit√°rio**

```javascript
// ‚úÖ EXEMPLO COMPLETO
describe("Validation Utils", () => {
  describe("validateId", () => {
    it("should validate normal IDs correctly", () => {
      // Arrange
      const normalId = 4;

      // Act
      const result = validateId(normalId);

      // Assert
      expect(result.isValid).toBe(true);
      expect(result.issues).toHaveLength(0);
      expect(result.isTimestamp).toBe(false);
      expect(result.isOverflow).toBe(false);
    });

    it("should detect timestamp-like IDs", () => {
      // Arrange
      const timestampId = 1755645845907;

      // Act
      const result = validateId(timestampId);

      // Assert
      expect(result.isValid).toBe(false);
      expect(result.issues).toContain("ID parece ser um timestamp");
      expect(result.isTimestamp).toBe(true);
      expect(result.isOverflow).toBe(true);
    });
  });
});
```

### **2. Teste de Componente (React/Vue/Angular)**

```javascript
// ‚úÖ EXEMPLO DE COMPONENTE REACT
import { render, screen } from "@testing-library/react";
import { UserList } from "@/components/UserList";

describe("UserList Component", () => {
  it("should render empty state when no users", () => {
    // Arrange
    const users = [];

    // Act
    render(<UserList users={users} />);

    // Assert
    expect(screen.getByText("Nenhum usu√°rio encontrado")).toBeInTheDocument();
  });

  it("should render users when provided", () => {
    // Arrange
    const users = [{ id: 1, name: "Jo√£o", email: "joao@test.com" }];

    // Act
    render(<UserList users={users} />);

    // Assert
    expect(screen.getByText("Jo√£o")).toBeInTheDocument();
    expect(screen.getByText("joao@test.com")).toBeInTheDocument();
  });
});
```

## ‚úÖ **VERIFICA√á√ÉO FINAL**

### **Antes de Concluir QUALQUER Teste**

- [ ] Padr√£o AAA implementado corretamente
- [ ] Nomes descritivos e espec√≠ficos
- [ ] Casos de borda cobertos
- [ ] Tratamento de erros testado
- [ ] Mocks usados adequadamente
- [ ] Testes independentes e isolados
- [ ] Cobertura m√≠nima mantida
- [ ] Todos os testes passando
- [ ] Estrutura organizada logicamente
- [ ] Integra√ß√£o com configura√ß√£o do projeto

## üîó **REFER√äNCIAS**

- [Core Rule](core-rule.mdc) - Regra base do sistema
- [Architecture Guidelines](architecture-guidelines.mdc) - Diretrizes de arquitetura
- [Jest Documentation](https://jestjs.io/docs/getting-started) - Documenta√ß√£o oficial do Jest
- [Testing Library](https://testing-library.com/) - Biblioteca para testes de componentes
