---
description: Arquitetura Grand Bazaar - Diretrizes para desenvolvimento de m√∫ltiplas apps independentes na plataforma Grand Bazaar
alwaysApply: true
---

# üèõÔ∏è Grand Bazaar Architecture - Arquitetura de M√∫ltiplos Apps

## üéØ Vis√£o Geral

O **Grand Bazaar** √© uma plataforma que atua como **controller e infraestrutura** para m√∫ltiplas aplica√ß√µes independentes, fazendo a ponte entre as APIs do PerformIt e as "apps" criadas por clientes ou pela Investtools.

### Conceito Fundamental

- **Grand Bazaar**: Plataforma controladora que hospeda m√∫ltiplas apps
- **Apps**: Aplica√ß√µes independentes e aut√¥nomas
- **Handicraft**: Sistema de cadastro de apps para clientes
- **Acesso**: Apps s√£o acessadas via `/gbf/{appName}`

## üö® COMPORTAMENTO OBRIGAT√ìRIO

### 1. A√ß√µes Cr√≠ticas para Desenvolvimento de Apps

1. **üö® CR√çTICO:** **SEMPRE entenda** que cada app √© uma aplica√ß√£o **independente e aut√¥noma**
2. **üö® CR√çTICO:** **SEMPRE respeite** a estrutura de diret√≥rios do Grand Bazaar
3. **üö® CR√çTICO:** **SEMPRE configure** o build para gerar arquivos est√°ticos na pasta da app
4. **üö® CR√çTICO:** **SEMPRE teste** a integra√ß√£o com o Grand Bazaar antes de commitar
5. **SEMPRE mantenha** cada app isolada e independente
6. **SEMPRE siga** os padr√µes de nomenclatura estabelecidos
7. **SEMPRE documente** a app no seu pr√≥prio README.md

### 2. Estrutura de Diret√≥rios

**SEMPRE organize** cada app como um diret√≥rio independente na raiz do Grand Bazaar:

```text
grand-bazaar/
‚îú‚îÄ‚îÄ README.md                    # Documenta√ß√£o do Grand Bazaar
‚îú‚îÄ‚îÄ package.json                 # Depend√™ncias do Grand Bazaar (se houver)
‚îú‚îÄ‚îÄ {app-name}/                  # Cada app √© um diret√≥rio independente
‚îÇ   ‚îú‚îÄ‚îÄ README.md                # Documenta√ß√£o espec√≠fica da app
‚îÇ   ‚îú‚îÄ‚îÄ package.json             # Depend√™ncias da app
‚îÇ   ‚îú‚îÄ‚îÄ src/                     # C√≥digo fonte da app
‚îÇ   ‚îú‚îÄ‚îÄ build/                   # Build de produ√ß√£o (gerado)
‚îÇ   ‚îî‚îÄ‚îÄ index.html               # Entry point da app
‚îú‚îÄ‚îÄ {outra-app}/                 # Outra app independente
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ ...
```

**‚ö†Ô∏è NUNCA**:

- **NUNCA misture** c√≥digo de apps diferentes
- **NUNCA compartilhe** depend√™ncias entre apps sem necessidade
- **NUNCA crie** depend√™ncias cruzadas entre apps

### 3. Nomenclatura de Apps

**SEMPRE use** nomenclatura consistente:

- **Nome da app**: kebab-case (ex: `new-quote`, `client-portfolio`, `operations`)
- **Nome do diret√≥rio**: Mesmo nome da app (ex: `new-quote/`)
- **Acesso via URL**: `/gbf/{app-name}` (ex: `/gbf/new-quote`)

**Padr√µes de Sufixos para Desenvolvimento**:

- **`-local`**: Desenvolvimento local (localhost:8000 ou localhost:3000)
- **`-dev`**: Desenvolvimento no Cloud9 (c9-dev.performit.com.br)

**Exemplos**:

- Produ√ß√£o: `/gbf/new-quote`
- Local: `/gbf/new-quote-local`
- Cloud9: `/gbf/new-quote-dev`

### 4. Build e Deploy

**SEMPRE configure** o build para gerar arquivos est√°ticos:

1. **Build output**: Deve gerar arquivos est√°ticos na pasta da app
2. **Entry point**: `index.html` na raiz da pasta da app
3. **Assets**: Todos os assets devem ser relativos ao `index.html`

**Configura√ß√£o Vite (exemplo)**:

```typescript
// vite.config.ts
export default defineConfig({
  build: {
    outDir: "build",
    emptyOutDir: true,
  },
  base: "./", // Importante: paths relativos
});
```

**‚ö†Ô∏è CR√çTICO**: **SEMPRE use** paths relativos (`./` ou `../`) para assets e imports

### 5. Integra√ß√£o com PerformIt

**SEMPRE configure** a integra√ß√£o corretamente:

#### Vari√°veis de Ambiente

**SEMPRE defina** vari√°veis de ambiente para cada app:

```env
# .env
VITE_API_BASE_URL=http://localhost:3000
VITE_API_BASE_GRAILS=http://localhost:8080
VITE_DEV_API_KEY=ESTE-E-O-USUARIO-INVESTTOOLS
VITE_DEV_ENVIRONMENT=true
```

#### Proxy para Desenvolvimento

**SEMPRE configure** proxy no Vite para desenvolvimento local:

```typescript
// vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      "/g": {
        target: "http://localhost:3000",
        changeOrigin: true,
      },
    },
  },
});
```

### 6. Handicraft e Cadastro de Apps

**SEMPRE entenda** o sistema de cadastro:

#### Para Clientes

- **Handicraft**: Sistema de cadastro de apps para clientes
- **Acesso**: `/g/handicraft/list` no PerformIt
- **Deploy**: Ap√≥s cadastro, apps s√£o acessadas via `/gbf/{appName}`

#### Para Desenvolvimento Interno

**SEMPRE use** os sufixos para desenvolvimento:

- **`-local`**: Busca em `http://localhost:8000/` ou `http://localhost:3000/`
- **`-dev`**: Busca em `https://c9-dev.performit.com.br/gb/`
- **Sem sufixo**: Busca em `https://s3.amazonaws.com/grandbazaar.performit.com.br/`

**L√≥gica de Default** (no Rails):

```ruby
def default_handicraft(app_name)
  if app_name.end_with?('-dev')
    # Cloud9
  elsif app_name.end_with?('-local')
    # Localhost
  else
    # AWS S3
  end
end
```

### 7. Desenvolvimento Local

**SEMPRE siga** este processo para desenvolvimento local:

1. **SEMPRE execute** o servidor de desenvolvimento da app:

   ```bash
   cd {app-name}
   npm run dev
   ```

2. **SEMPRE configure** o Grand Bazaar local (se necess√°rio):

   ```bash
   npm install
   npm run dev
   ```

3. **SEMPRE acesse** via PerformIt com sufixo `-local`:

   ```text
   http://localhost:3000/gbf/{app-name}-local
   ```

### 8. Estrutura de Cada App

**SEMPRE organize** cada app seguindo esta estrutura:

```text
{app-name}/
‚îú‚îÄ‚îÄ README.md                    # Documenta√ß√£o da app
‚îú‚îÄ‚îÄ package.json                 # Depend√™ncias
‚îú‚îÄ‚îÄ vite.config.ts               # Configura√ß√£o Vite
‚îú‚îÄ‚îÄ tsconfig.json                # Configura√ß√£o TypeScript
‚îú‚îÄ‚îÄ index.html                   # Entry point HTML
‚îú‚îÄ‚îÄ .env                         # Vari√°veis de ambiente (n√£o commitado)
‚îú‚îÄ‚îÄ .env_example                 # Exemplo de vari√°veis
‚îú‚îÄ‚îÄ src/                         # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ components/              # Componentes reutiliz√°veis
‚îÇ   ‚îú‚îÄ‚îÄ pages/                   # P√°ginas da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                   # Custom hooks
‚îÇ   ‚îú‚îÄ‚îÄ utils/                   # Utilit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ types/                   # Tipos TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ main.tsx                 # Entry point React
‚îú‚îÄ‚îÄ build/                       # Build de produ√ß√£o (gerado)
‚îî‚îÄ‚îÄ docs/                        # Documenta√ß√£o espec√≠fica da app
```

### 9. Documenta√ß√£o

**SEMPRE documente** cada app:

#### README.md da App

**SEMPRE inclua** no README.md de cada app:

- Descri√ß√£o da funcionalidade
- Tecnologias utilizadas
- Estrutura do projeto
- Instala√ß√£o e setup
- Scripts dispon√≠veis
- Configura√ß√£o de ambiente
- Integra√ß√£o com Grand Bazaar
- Rotas e funcionalidades principais

#### Documenta√ß√£o T√©cnica

**SEMPRE mantenha** documenta√ß√£o t√©cnica em `docs/`:

- Boas pr√°ticas espec√≠ficas da app
- Padr√µes de c√≥digo
- Troubleshooting
- Guias de desenvolvimento

### 10. Isolamento e Independ√™ncia

**SEMPRE mantenha** apps isoladas:

- **NUNCA compartilhe** c√≥digo entre apps diretamente
- **NUNCA crie** depend√™ncias entre apps
- **SEMPRE trate** cada app como um projeto independente
- **SEMPRE use** bibliotecas compartilhadas apenas quando necess√°rio

**Exce√ß√µes** (apenas quando absolutamente necess√°rio):

- Bibliotecas compartilhadas via npm packages
- Utilit√°rios comuns via imports externos
- APIs compartilhadas do PerformIt

### 11. Qualidade e Padr√µes

**SEMPRE siga** os padr√µes de qualidade:

#### TypeScript

- **SEMPRE use** TypeScript para tipagem
- **SEMPRE defina** tipos expl√≠citos
- **SEMPRE evite** `any` quando poss√≠vel

#### React

- **SEMPRE use** componentes funcionais
- **SEMPRE use** hooks para l√≥gica reutiliz√°vel
- **SEMPRE siga** padr√µes de nomenclatura (PascalCase para componentes)

#### Testes

- **SEMPRE escreva** testes para funcionalidades cr√≠ticas
- **SEMPRE mantenha** cobertura adequada
- **SEMPRE teste** integra√ß√£o com APIs

#### Linting e Formata√ß√£o

- **SEMPRE use** Biome ou ESLint + Prettier
- **SEMPRE configure** Husky para pre-commit hooks
- **SEMPRE valide** c√≥digo antes de commitar

### 12. Debugging Local

**SEMPRE use** estas t√©cnicas para debugging:

#### WebStorm

1. **SEMPRE configure** JavaScript Debug configuration
2. **SEMPRE use** URL com sufixo `-local`
3. **SEMPRE configure** Remote URLs corretamente

#### Chrome DevTools

1. **SEMPRE use** source maps para debugging
2. **SEMPRE configure** breakpoints no c√≥digo fonte
3. **SEMPRE verifique** network requests para APIs

### 13. Deploy e Produ√ß√£o

**SEMPRE siga** este processo para deploy:

1. **SEMPRE execute** build de produ√ß√£o:

   ```bash
   npm run build
   ```

2. **SEMPRE valide** o build localmente:

   ```bash
   npm run preview
   ```

3. **SEMPRE teste** a integra√ß√£o com Grand Bazaar

4. **SEMPRE verifique** que todos os assets est√£o acess√≠veis

5. **SEMPRE confirme** que a app funciona via `/gbf/{app-name}`

## 14. Boas Pr√°ticas para Apps React Modernas

**‚ö†Ô∏è IMPORTANTE**: O Grand Bazaar suporta m√∫ltiplas stacks (React, Vue.js, JavaScript vanilla, etc.), mas **apps React modernas** (novas apps) **SEMPRE devem seguir** estas boas pr√°ticas estabelecidas.

### 14.1 Estrutura de Projeto e Organiza√ß√£o

**SEMPRE organize** apps React seguindo esta estrutura:

```text
src/
‚îú‚îÄ‚îÄ components/          # Componentes reutiliz√°veis (crud, form, utility)
‚îú‚îÄ‚îÄ configs/            # Configura√ß√µes de exporta√ß√£o
‚îú‚îÄ‚îÄ constants/          # Constantes da aplica√ß√£o
‚îú‚îÄ‚îÄ context/            # Contextos React
‚îú‚îÄ‚îÄ functions/          # Fun√ß√µes utilit√°rias
‚îú‚îÄ‚îÄ hooks/              # Custom hooks (queries, sorting)
‚îú‚îÄ‚îÄ lib/                # Bibliotecas e configura√ß√µes
‚îú‚îÄ‚îÄ models/             # Modelos TypeScript
‚îú‚îÄ‚îÄ page-components/    # Componentes de p√°gina (por dom√≠nio)
‚îú‚îÄ‚îÄ pages/              # P√°ginas da aplica√ß√£o
‚îú‚îÄ‚îÄ schemas/            # Schemas Zod
‚îú‚îÄ‚îÄ types/              # Tipos TypeScript
‚îî‚îÄ‚îÄ utils/              # Utilit√°rios diversos
```

**SEMPRE use** nomenclatura consistente:

- **Componentes**: PascalCase (`SelectField.tsx`, `CreatePageComponent.tsx`)
- **Hooks**: camelCase com prefixo `use` (`useTable.ts`, `useQuoteListQuery.ts`)
- **Utils/Schemas/Types/Models**: camelCase (`apiUtils.ts`, `quoteSchema.ts`, `quote.ts`)

### 14.2 TypeScript e Tipagem

**SEMPRE use** tipos expl√≠citos em fun√ß√µes, props e retornos. **SEMPRE use** tipos gen√©ricos para hooks e componentes reutiliz√°veis:

```typescript
// ‚úÖ CORRETO: Tipos expl√≠citos e gen√©ricos
export function useTable<TData extends RowData, TValue = unknown>({
  data,
  columns,
}: UseTableProps<TData, TValue>): UseTableReturn<TData> {
  // ...
}

export function usePaginatedListQuery<
  TFilter extends BaseFilterStorage,
  TData,
  TParams
>(
  config: ListQueryConfig<TFilter, TParams, TData>,
  initialFilter: TFilter
): UsePaginatedListQueryReturn<TFilter, TData> {
  // ...
}
```

**SEMPRE use** Zod para valida√ß√£o e infer√™ncia autom√°tica de tipos:

```typescript
export const quoteSchema = z.object({
  symbol: autoCompleteSchema.nullable().refine((val) => val !== null, {
    message: "O ativo √© obrigat√≥rio.",
  }),
  day: z.union([z.string().min(1), z.date()]),
  close: decimalField("close"),
});

export type QuoteFormValues = z.infer<typeof quoteSchema>;
```

**SEMPRE organize**: Tipos compartilhados em `types/`, modelos em `models/`.

### 14.3 React e Componentes

**SEMPRE use** componentes funcionais com TypeScript. **SEMPRE documente** props complexas:

```typescript
type CreatePageComponentProps = {
  title: string;
  description: string;
  form: ReactNode;
};

export function CreatePageComponent({
  title,
  description,
  form,
}: CreatePageComponentProps) {
  return (
    <Container>
      <ChildContainer>
        <SectionInfo title={title} description={description} />
        {form}
      </ChildContainer>
    </Container>
  );
}
```

**SEMPRE use** componentes do IVT para UI consistente (`ivt/layout`, `ivt/button`, `ivt/form`). **SEMPRE reutilize** componentes CRUD gen√©ricos (`CreatePageComponent`, `EditPageComponent`, `ListPageComponent`).

### 14.4 Formul√°rios e Valida√ß√£o

**SEMPRE use** React Hook Form com Zod para gerenciamento de formul√°rios:

```typescript
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";

export function QuoteForm() {
  const form = useForm<QuoteFormValues>({
    resolver: zodResolver(quoteSchema),
    defaultValues: {
      /* ... */
    },
  });

  return <Form {...form}>{/* ... */}</Form>;
}
```

**SEMPRE crie** schemas Zod para valida√ß√£o e infer√™ncia de tipos. **SEMPRE crie** componentes de formul√°rio reutiliz√°veis (`SelectField`, `DateField`, etc.).

### 14.5 Hooks Customizados

**SEMPRE crie** hooks especializados para queries com TanStack Query:

```typescript
export function useQuoteListQuery(): UsePaginatedListQueryReturn<
  FilterStorage,
  Quote
> {
  const dayRange = useDayRange();
  const initialFilter: FilterStorage = { day: dayRange };
  return usePaginatedListQuery<FilterStorage, Quote, QuoteListParams>(
    quoteQueryConfig,
    initialFilter
  );
}
```

**SEMPRE use** hooks especializados para gerenciar ordena√ß√£o:

```typescript
export function useTableSorting(
  sorting: SortingState,
  sortingConfig: ISortingConfig
) {
  const apiParams = useMemo(
    () => convertSortingToApiParams(sorting, sortingConfig),
    [sorting, sortingConfig]
  );
  return {
    apiParams,
    isValidSorting,
    currentSortField,
    currentSortDirection,
    sortableFields: sortingConfig.sortableFields,
  };
}
```

**SEMPRE crie** classes de configura√ß√£o seguindo SOLID:

```typescript
export class QuoteSortingConfig extends BaseSortingConfig {
  protected readonly _columnToBackendMap: Record<string, string> = {
    securitySymbol: "symbol",
    securityTypeName: "securityClass",
    day: "day",
    close: "close",
  };
}
export const quoteSortingConfig = new QuoteSortingConfig();
```

### 14.6 Context API

**SEMPRE crie** contextos separados por dom√≠nio de neg√≥cio com hooks customizados:

```typescript
export interface QuoteModel {
  isPendingAction: boolean;
  selectedQuote: Quote | null;
  filterStorage: FilterStorage;
  pagination: PaginationState;
  sorting: SortingState;
  getByIdQuote: (id: number) => Promise<void>;
  createQuote: (data: QuoteDto) => Promise<void>;
}

export function QuoteProvider({ children }: QuoteProviderProps) {
  return (
    <QuoteContext.Provider value={value}>{children}</QuoteContext.Provider>
  );
}

export function useQuoteContext(): QuoteModel {
  const context = useContext(QuoteContext);
  if (!context) {
    throw new Error("useQuoteContext must be used within QuoteProvider");
  }
  return context;
}
```

**SEMPRE mantenha** contextos focados em um √∫nico dom√≠nio (`QuoteContext`, `MarketIndexContext`, `ExchangeRateContext`).

### 14.7 TanStack Query

**SEMPRE use** TanStack Query para estado servidor. **SEMPRE configure** cache e invalida√ß√£o:

```typescript
import { CACHE_TIME } from "@/constants/cache";

const { data, isLoading, isFetching, error } = useQuery({
  queryKey: ["quotes", filter, pagination, sorting],
  queryFn: () => fetchQuotes(filter, pagination, sorting),
  staleTime: CACHE_TIME,
});

// Invalida√ß√£o ap√≥s muta√ß√£o
const mutation = useMutation({
  mutationFn: createQuote,
  onSuccess: () => {
    queryClient.invalidateQueries({ queryKey: ["quotes"] });
  },
});
```

**SEMPRE use** pagina√ß√£o server-side para grandes volumes de dados com `usePaginatedListQuery`. **SEMPRE trate** loading, fetching e error:

```typescript
const { data, isLoading, isFetching, isError, error } = useQuery({
  queryKey: ["quotes"],
  queryFn: fetchQuotes,
});

if (isLoading) return <LoadingSkeleton />;
if (isError) return <ErrorMessage error={error} />;
if (!data) return null;
```

### 14.8 TanStack Table

**SEMPRE use** o hook `useTable` para configurar tabelas. **SEMPRE configure** server-side:

```typescript
const { table, hasSelectedRows, selectedOriginalsRowsData } = useTable({
  data: quotes,
  columns: quoteColumns,
  defaultSorting: [{ id: "day", desc: true }],
  pagination,
  onPaginationChange: setPagination,
  sorting,
  onSortingChange: setSorting,
  pageCount: Math.ceil(totalItems / pagination.pageSize),
  totalRows: totalItems,
});

const table = useReactTable({
  data,
  columns,
  manualPagination: true,
  manualSorting: true,
  manualFiltering: true,
  pageCount: pageCount,
  rowCount: totalRows,
});
```

**SEMPRE defina** colunas com tipos expl√≠citos (`ColumnDef<Quote>[]`). **SEMPRE use** hooks utilit√°rios (`useExportData`) para exporta√ß√£o CSV/Excel.

### 14.9 API e HTTP

**SEMPRE use** o cliente Axios configurado (`lib/server.ts`):

```typescript
import server from "@/lib/server";
const api = server(); // Cliente com interceptors configurados
const response = await api.get("/quotes");
```

**SEMPRE configure** interceptors para autentica√ß√£o autom√°tica e tratamento centralizado de erros:

```typescript
instance.interceptors.request.use(async (req) => {
  if (config().dev_environment && config().dev_api_key) {
    req.headers["X-API-Key"] = config().dev_api_key;
  }
  return req;
});

instance.interceptors.response.use(
  (response) => response,
  (error) => {
    if (globalToast) handleAxiosError(error, globalToast);
    return Promise.reject(error);
  }
);
```

**SEMPRE use** `handleApiResponse` para tratamento de respostas. **SEMPRE forne√ßa** feedback via toast (`useSonner`).

### 14.10 Estiliza√ß√£o

**SEMPRE use** Tailwind CSS 4 via plugin Vite e componentes IVT para UI consistente:

```typescript
// vite.config.ts
import tailwindcss from "@tailwindcss/vite";
export default defineConfig({
  plugins: [react(), tailwindcss()],
});

// Uso
import { Container, ChildContainer } from "ivt/layout";
import { Button } from "ivt/button";
import { FormControl, FormItem, FormLabel } from "ivt/form";
```

**SEMPRE use** classes utilit√°rias e responsivas do Tailwind. **SEMPRE considere** acessibilidade (`aria-*`, `aria-label`).

### 14.11 Infrastructure e Clean Architecture

**‚ö†Ô∏è IMPORTANTE**: A camada de **infrastructure** √© a camada mais externa da Clean Architecture. Em **apps pequenos** (como no Grand-Bazaar), ela √© a **√∫nica camada necess√°ria**, implementando toda a l√≥gica de comunica√ß√£o externa, transforma√ß√£o de dados e orquestra√ß√£o.

**Princ√≠pios Aplicados**:

1. **Dependency Rule**: Models s√£o estruturas simples (interfaces/types), Infrastructure implementa toda a l√≥gica. Depend√™ncias apontam para dentro (Services ‚Üí Mappers ‚Üí DTOs).
2. **Separation of Concerns**: API/Interceptors (HTTP, erros, auth), Services (orquestra√ß√£o), Mappers (convers√£o DTO ‚Üî Model).
3. **Inversion of Control**: Interfaces definidas nos models, Infrastructure implementa.

**SEMPRE organize** a camada infrastructure:

```text
src/infrastructure/
‚îú‚îÄ‚îÄ api/                    # Comunica√ß√£o HTTP (agn√≥stico ao dom√≠nio)
‚îÇ   ‚îú‚îÄ‚îÄ client/            # Cliente HTTP (Axios)
‚îÇ   ‚îú‚îÄ‚îÄ dto/               # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ endpoints/         # Endpoints tipados
‚îÇ   ‚îî‚îÄ‚îÄ interceptors/     # Interceptores (erros, auth, logging)
‚îú‚îÄ‚îÄ services/              # Orquestra√ß√£o e casos de uso
‚îÇ   ‚îú‚îÄ‚îÄ base/             # BaseService
‚îÇ   ‚îî‚îÄ‚îÄ {entity}/         # Services espec√≠ficos
‚îú‚îÄ‚îÄ mappers/               # Convers√£o DTO ‚Üî Model
‚îÇ   ‚îú‚îÄ‚îÄ IDataMapper.ts
‚îÇ   ‚îî‚îÄ‚îÄ {Entity}Mapper.ts
‚îî‚îÄ‚îÄ config/                # Configura√ß√µes
```

**SEMPRE siga** estas conven√ß√µes:

- **DTOs**: Use sufixo `{Entity}DTO`, mantenha em `api/dto/` separados de `models/`, use `null` quando API retorna `null`.
- **Endpoints**: Fun√ß√µes tipadas em UPPER*CASE (`{METHOD}*{ENTITY}\_{ACTION}`), aceitem par√¢metros tipados, usem `URLSearchParams` para query strings.
- **Services**: Orquestram API + Mapper. **SEMPRE use** mappers para convers√£o, endpoints tipados, retorne entidades/models (nunca DTOs).
- **Mappers**: **SEMPRE implemente** `IDataMapper`, converta `null` (API) ‚Üí `undefined` (Model), remova `undefined` antes de enviar para API, **NUNCA adicione** valida√ß√µes de neg√≥cio.

**Exemplo de Service**:

```typescript
export class QuoteService extends BaseService<
  Quote,
  QuoteDTO,
  number,
  QuoteCreate,
  QuoteUpdate
> {
  protected readonly endpoint = "/quote";
  protected readonly mapper = new QuoteMapper();

  async findById(id: number): Promise<Quote | null> {
    const response = await this.apiClient.get<QuoteDTO>(GET_QUOTE_ID({ id }));
    if (!response.data) return null;
    return this.toDomain(response.data);
  }
}
```

**Exemplo de Mapper**:

```typescript
export class QuoteMapper
  implements IDataMapper<Quote, QuoteDTO, QuoteCreate, QuoteUpdate>
{
  toDomain(data: QuoteDTO): Quote {
    return {
      id: data.id,
      symbol: data.symbol,
      day: data.day,
      close: data.close,
      volume: data.volume ?? undefined, // null ‚Üí undefined
    };
  }

  toApiRequest(data: QuoteCreate | QuoteUpdate): unknown {
    const cleaned: Record<string, unknown> = {};
    if (data.symbol !== undefined) cleaned.symbol = data.symbol;
    if (data.day !== undefined) cleaned.day = data.day;
    if (data.close !== undefined) cleaned.close = data.close;
    return cleaned;
  }
}
```

**Checklist - Novo Service**: Criar DTO, mapper (`IDataMapper`), endpoints, service (`BaseService`), testar CRUD e convers√£o DTO ‚Üî Model.

**Checklist - Novo Endpoint**: Fun√ß√£o em `api/endpoints/index.ts`, padr√£o `{METHOD}_{ENTITY}_{ACTION}`, par√¢metros tipados, `URLSearchParams`, `API_URL_BASE`.

**Checklist - Novo Mapper**: Implementar `IDataMapper`, `toDomain()` (DTO ‚Üí Model), `toApiRequest()` (Model ‚Üí API), converter `null` ‚Üí `undefined`, remover `undefined` antes de enviar.

### 14.12 Qualidade de C√≥digo

**SEMPRE execute** Biome antes de commitar (`npm run biome:fix`). **SEMPRE configure** em `biome.json`:

```json
{
  "formatter": { "enabled": true, "indentStyle": "tab" },
  "linter": { "enabled": true, "rules": { "recommended": true } }
}
```

**SEMPRE use** ESLint para regras adicionais e Prettier com plugin Tailwind. **SEMPRE configure** Husky e lint-staged:

```bash
# .husky/pre-commit
npm run biome:fix
```

**Checklist antes de commitar**: `npm run biome:fix`, `npm run build`, `npm run preview`.

### 14.13 Princ√≠pios Aplicados

**SEMPRE aplique** estes princ√≠pios:

- **SOLID**: Single Responsibility, Interface Segregation
- **DRY**: Don't Repeat Yourself
- **YAGNI**: You Aren't Gonna Need It
- **Clean Code**: C√≥digo limpo, leg√≠vel e manuten√≠vel
- **Type Safety**: Tipagem forte com TypeScript

## üîó Integra√ß√£o com Outras Regras

### Regras Relacionadas

- **Core Rule**: [core-rule.mdc](core/core-rule.mdc) - Diretrizes fundamentais
- **Architecture Guidelines**: [architecture-guidelines.mdc](architecture-guidelines.mdc) - Clean Code, TDD, DDD
- **React Rule**: [react-rule.mdc](react-rule.mdc) - Padr√µes React espec√≠ficos
- **TypeScript**: [typescript.mdc](front/typescript.mdc) - Padr√µes TypeScript

## ‚úÖ Checklist de Desenvolvimento

**ANTES de desenvolver uma nova app ou modificar uma existente**:

- [ ] **üö® CR√çTICO**: Entendi que a app √© independente e aut√¥noma
- [ ] **üö® CR√çTICO**: Estrutura de diret√≥rios est√° correta
- [ ] **üö® CR√çTICO**: Build est√° configurado corretamente
- [ ] **üö® CR√çTICO**: Vari√°veis de ambiente est√£o configuradas
- [ ] **üö® CR√çTICO**: Proxy est√° configurado para desenvolvimento
- [ ] Nomenclatura segue padr√µes estabelecidos
- [ ] README.md est√° completo e atualizado
- [ ] Documenta√ß√£o t√©cnica est√° atualizada
- [ ] Testes est√£o implementados
- [ ] Linting e formata√ß√£o est√£o configurados
- [ ] Integra√ß√£o com Grand Bazaar foi testada

**ANTES de fazer deploy**:

- [ ] Build de produ√ß√£o foi executado
- [ ] Build foi testado localmente (`npm run preview`)
- [ ] Todos os assets est√£o acess√≠veis
- [ ] Integra√ß√£o com APIs foi testada
- [ ] App funciona via `/gbf/{app-name}`
- [ ] Documenta√ß√£o est√° atualizada

## üìö Refer√™ncias

### Documenta√ß√£o do Projeto

- **README.md** (raiz): Vis√£o geral do Grand Bazaar
- **README.md** (cada app): Documenta√ß√£o espec√≠fica da app
- **docs/** (cada app): Documenta√ß√£o t√©cnica detalhada

### Exemplos de Apps

- **new-quote**: App React moderna com TypeScript, Vite, TanStack Query
- **operations**: App React com TypeScript
- **client-portfolio**: App React com TypeScript

### Padr√µes Identificados

- Apps modernas usam **React + TypeScript + Vite**
- Apps mais antigas podem usar **Vue.js** ou **JavaScript vanilla**
- Todas as apps geram **build est√°tico** para deploy

## üö´ Limites Absolutos

- **NUNCA misture** c√≥digo de apps diferentes
- **NUNCA crie** depend√™ncias cruzadas entre apps
- **NUNCA compartilhe** estado entre apps
- **NUNCA assuma** que uma app conhece outra app
- **NUNCA pule** o processo de build e valida√ß√£o antes de deploy
